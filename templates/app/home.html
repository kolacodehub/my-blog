{% extends 'base.html' %}
{% load humanize %}

{% block head_title %}
    - Your Articles
{% endblock head_title %}
    

{% block base_content %}
<main class="max-w-7xl mx-auto mt-4 p-2 md:p-4 lg:p-10">
    <h1 class="title mb-4">Home</h1>

    <p class="mb-4 text-xl">
        You have created {{ user.article_count | intcomma }} 
        article{{ user.article_count | pluralize }}
        and written {{ user.written_word | intcomma }} 
        word{{ user.written_word | pluralize }}.
    </p>

    <a class="button primary w-full text-center sm:w-auto inline-block mb-6" href="{% url 'create_article' %}">Create New Article</a>
    <h2 class="subtitle mb-6 font-semibold">Your Latest Articles</h2>

    <form action="" method="GET" class="mb-6 flex sm:flex-row sm:items-center">
        <input type="search" name="search" placeholder="Search articles..." value="{{ request.GET.search }}" class="border border-gray-300 rounded-md p-2 mr-2" 
        hx-get="{{ request.path }}" 
        hx-trigger="input changed delay:500ms, search" 
        hx-target="#article-results" 
        hx-select="#article-results"
        hx-indicator="svg.loading"
        hx-disabled-elt="next button"
        hx-push-url="true"  />
        <button type="submit" class="button primary flex gap-1 disabled:cursor-not-allowed disabled:opacity-50 [&>.loading.htmx-request.hidden]:!inline-block [&>.loading.htmx-request]:hidden">
            {% include 'svgs/magnifier.svg' with class='loading w-6 h-6 mr-2' %}
            {% include 'svgs/loading.svg' with class='loading w-6 h-6 mr-2 hidden motion-safe:animate-spin' %}
            Search
        </button>
        <a href="{{ request.path }}" class="button secondary text-center ml-2">Clear search</a>
    </form>

    <div id="article-results">
        {% if articles %}
            <ul preload="mouseover">
                {% comment %} articles is from views.py context {% endcomment %}
                {% for article in articles %}
                    <li><a class="text-2xl flex items-center" href="{% url 'update_article' article.id %}"><span class="hover:text-cyan-700">{{ article.title }}</span>
                        <span class="ml-2 px-4 py-0.5 text-xs rounded-sm uppercase article-status-{{article.status}}"> {{ article.status }} </span> </a> 
                        <p class="text-sm">{{ article.word_count }} word{{ article.word_count | pluralize }}</p>
                    </li>
                {% endfor %}
            </ul>
            
            {% if is_paginated %}
                <div class="flex flex-row items-center justify-center mt-6 text-xl">
                    {% if page_obj.has_previous %}
                        <a class="mx-2" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
                            {% include "svgs/chevron.svg" with class="w-7 h-7 rotate-180 border border-black rounded-md p-1" %}
                        </a>
                    {% endif %}
                    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                    {% if page_obj.has_next %}
                        <a class="mx-2" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
                            {% include "svgs/chevron.svg" with class="w-7 h-7 border border-black rounded-md p-1" %}
                        </a>
                    {% endif %}
                </div>
            {% endif %}
                
        {% else %}
            <p>You have no articles yet</p>
        {% endif %}
    </div>
</main>
{% endblock base_content %}
    
